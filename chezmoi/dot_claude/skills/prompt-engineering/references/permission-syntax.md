### 権限ルール構文

権限ルールは `Tool` または `Tool(specifier)` の形式に従います。構文を理解することで、意図したものと正確に一致するルールを作成するのに役立ちます。

#### ルール評価順序

同じツール使用に複数のルールが一致する可能性がある場合、ルールは次の順序で評価されます：

1. **Deny** ルールが最初にチェックされます
2. **Ask** ルールが 2 番目にチェックされます
3. **Allow** ルールが最後にチェックされます

最初に一致するルールが動作を決定します。これは、両方が同じコマンドに一致する場合でも、deny ルールが常に allow ルールより優先されることを意味します。

#### ツールのすべての使用に一致

ツールのすべての使用に一致させるには、括弧なしでツール名を使用します：

| ルール        | 効果                        |
| :--------- | :------------------------ |
| `Bash`     | **すべての** Bash コマンドに一致     |
| `WebFetch` | **すべての** web フェッチリクエストに一致 |
| `Read`     | **すべての**ファイル読み取りに一致       |

<Warning>
  `Bash(*)` は**すべての** Bash コマンドに一致しません。`*` ワイルドカードは specifier コンテキスト内でのみ一致します。ツールのすべての使用を許可または拒否するには、ツール名のみを使用します：`Bash(*)` ではなく `Bash`。
</Warning>

#### 細かい制御のための specifier の使用

括弧内に specifier を追加して、特定のツール使用に一致させます：

| ルール                            | 効果                             |
| :----------------------------- | :----------------------------- |
| `Bash(npm run build)`          | 正確なコマンド `npm run build` に一致    |
| `Read(./.env)`                 | 現在のディレクトリの `.env` ファイルの読み取りに一致 |
| `WebFetch(domain:example.com)` | example.com へのフェッチリクエストに一致     |

#### ワイルドカードパターン

Bash ルールには 2 つのワイルドカード構文が利用可能です：

| ワイルドカード | 位置          | 動作                                                           | 例                                               |
| :------ | :---------- | :----------------------------------------------------------- | :---------------------------------------------- |
| `:*`    | パターンの末尾のみ   | **プレフィックスマッチング**（単語境界付き）。プレフィックスの後にスペースまたは文字列の終わりが続く必要があります。 | `Bash(ls:*)` は `ls -la` に一致しますが、`lsof` には一致しません |
| `*`     | パターン内の任意の場所 | **グロブマッチング**（単語境界なし）。その位置の任意の文字シーケンスに一致します。                  | `Bash(ls*)` は `ls -la` と `lsof` の両方に一致          |

**`:*` を使用したプレフィックスマッチング**

`:*` サフィックスは、指定されたプレフィックスで始まるコマンドに一致します。これは複数単語のコマンドで機能します。次の構成は npm と git commit コマンドを許可し、git push と rm -rf をブロックします：

```json  theme={null}
{
  "permissions": {
    "allow": [
      "Bash(npm run:*)",
      "Bash(git commit:*)",
      "Bash(docker compose:*)"
    ],
    "deny": [
      "Bash(git push:*)",
      "Bash(rm -rf:*)"
    ]
  }
}
```

**`*` を使用したグロブマッチング**

`*` ワイルドカードはパターンの開始、中央、または末尾に表示できます。次の構成は main をターゲットとするすべての git コマンド（`git checkout main`、`git merge main` など）とすべてのバージョンチェックコマンド（`node --version`、`npm --version` など）を許可します：

```json  theme={null}
{
  "permissions": {
    "allow": [
      "Bash(git * main)",
      "Bash(* --version)"
    ]
  }
}
```

<Warning>
  コマンド引数を制限しようとする Bash 権限パターンは脆弱です。たとえば、`Bash(curl http://github.com/:*)` は curl を GitHub URL に制限することを意図していますが、`curl -X GET http://github.com/...`（URL の前のフラグ）、`curl https://github.com/...`（異なるプロトコル）、またはシェル変数を使用するコマンドには一致しません。引数制約パターンをセキュリティ境界として信頼しないでください。[Bash 権限制限](/ja/iam#tool-specific-permission-rules)で代替案を参照してください。
</Warning>

ツール固有の権限パターンの詳細情報（Read、Edit、WebFetch、MCP、Task ルール、および Bash 権限制限を含む）については、[ツール固有の権限ルール](/ja/iam#tool-specific-permission-rules)を参照してください。
